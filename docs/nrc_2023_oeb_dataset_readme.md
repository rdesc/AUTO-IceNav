# NRC OEB 2023 Data

This document describes the data collected and processed from the NRC OEB 2023 field trials.
Note, links in this readme only work if this file is open from inside the `docs/` directory inside the repository root directory.

The main post-processing script is [evaluate_run_nov_2023_oeb_tank.py](../ship_ice_planner/evaluation/evaluate_run_nov_2023_oeb_tank.py)
which can be used to regenerate the plots, metrics, and post processed videos for the trials. 
The global variable `NRC_OEB_2023_EXP_ROOT` needs to be set to the file path of where this dataset is stored.
```shell
python -m ship_ice_planner.evaluation.evaluate_run_nov_2023_oeb_tank
```

The dataset is organized by navigation method and trial, with each trial having its own directory.
Each trial directory contains the following files:

### `HD Basin Cam Videos/`
Directory containing the raw video files from the HD basin cameras.
This directory only exists for the select trials that we recorded video using the HD basin cameras.

### `gdac_plots/`
Directory containing plots of the data collected using GDAC during the live tests for each planning iteration.
The world (i.e. tank) coordinate system is used to plot the path, obstacles, and ship state.

Relevant script: [process_daq_data.py](../ship_ice_planner/evaluation/process_daq_data.py)

### `paths/`
Directory containing all the `.pkl` files containing the saved out information for each planning iteration.
This includes the planned path, message data, time stamp, and other important data / metadata.

### `plots/`
Directory containing the plots generated by the planner code live during the trials. These plots
were essential in monitoring trial progress and debugging.

### `cam_timestamps.pkl`
Pickle file containing a list of timestamps for each camera frame for the trial.
This file was generated in post-processing and is used to synchronize the camera frames with the GDAC data.

Relevant script: [timing_file_parser.py](../ship_ice_planner/evaluation/timing_file_parser.py)

### `config.yaml`
YAML file containing the configuration parameters used for the planner during the trial.
Note, the configuration file is no longer consistent with configuration files used in the codebase.

### `first_frame.png`
Image file containing the first frame of the video from the overhead camera.

Relevant script: [process_overhead_video.py](../ship_ice_planner/image_process/process_overhead_video.py)

### `gdac_summary.png`
Image file containing a summary of the DAQ data collected during the trial.

Relevant script: [process_daq_data.py](../ship_ice_planner/evaluation/process_daq_data.py)

### `gdac_summary.txt`
Text file containing a summary of the DAQ data collected during the trial as well as metrics computed from DAQ or planner data.

Relevant script: [process_daq_data.py](../ship_ice_planner/evaluation/process_daq_data.py)

### `ice_tracking.pkl`
Contains tracking data for all the segmented ice pieces. Each ice piece was tracked using a Kalman filter.
Ice tracking was done during post-processing.

Relevant script: [evaluate_ice_data.py](../ship_ice_planner/evaluation/evaluate_ice_data.py)

### `ice_tracking.png`
Provides a visual summary of the ice tracking results. The red paths indicate the ice pieces 
which were detected to have been in direct or indirect (via a chain of ice floes) contact with the ship.
The path of each tracked ice floe is shown in black.

Relevant script: [evaluate_ice_data.py](../ship_ice_planner/evaluation/evaluate_ice_data.py)

### `lattice1_adv_01_50Hz.csv`
CSV file containing the data collected from GDAC during the trial.
This csv file was generated from the original `.daq` file.

Relevant script: [daq_columns.py](../ship_ice_planner/NRC_wrapper/daq_columns.py)

### `lattice1_adv_01_cam0.mkv`
The original video file recorded from the overhead camera.

Relevant script: [process_overhead_video.py](../ship_ice_planner/image_process/process_overhead_video.py)

### `lattice1_adv_01_cam0.timing`
The original file containing the ice segmentation data.

Relevant script: [process_overhead_video.py](../ship_ice_planner/image_process/process_overhead_video.py)

### `lattice1_adv_01.daq`
The original DAQ file containing the data collected during the trial.
In post-processing this file is converted to a csv for easier handling.

Relevant script: [daq_columns.py](../ship_ice_planner/NRC_wrapper/daq_columns.py)

### `log.txt`
The log file generated during the trial. This file contains the output from the planner code.

### `metrics.txt`
Text file containing metrics and other useful debugging information computed during the trial from the planner code.

### `no_overlay_video_x2_speed.mp4`
Video file containing the overhead camera video trimmed to the trial duration and sped up by a factor of 2.

Relevant script: [process_overhead_video.py](../ship_ice_planner/image_process/process_overhead_video.py)

### `overlay_video_x2_speed.mp4`
Video file containing the overhead camera video with the planned path overlayed (and optionally the segmented ice) on top.

Relevant script: [process_overhead_video.py](../ship_ice_planner/image_process/process_overhead_video.py)

### `planner_data_transformed.pkl`
This file was generated during post-processing and contains the planner data transformed to the world coordinate system.
This data should have been saved out during the trial, but was not due to missing logic in the planner code for saving 
the message data sent to the NRC computers.

Relevant script: [evaluate_run_nov_2023_oeb_tank.py](../ship_ice_planner/evaluation/evaluate_run_nov_2023_oeb_tank.py)

### `start_end_timesteps.txt`
Contains the start and end timesteps and timestamps for the trial. This file was generated during post-processing.
This file can be manually edited to adjust the start and end timesteps for the trial. Timesteps and timestamps are found
in the `lattice2_adv_36_50Hz.csv` file.

Relevant script: [daq_columns.py](../ship_ice_planner/NRC_wrapper/daq_columns.py)
